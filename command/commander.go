package command

import (
	"github.com/codegangsta/cli"
	"github.com/denkhaus/cloudia/manifest"
)

type Commander struct {
	loader ManifestLoader
	app    *cli.App
}

///////////////////////////////////////////////////////////////////////////////////////////////
// GetContainers
///////////////////////////////////////////////////////////////////////////////////////////////
func (c *Commander) GetContainers(c *cli.Context) Containers {
	man, err := c.loader.Load(c.String("manifest"))
	if err != nil {

	}
	cont, err := man.GetTargetedContainers(c.String("group"))
	if err != nil {

	}
	return man.Containers.filter(cont)
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (c *Commander) containersCommand(wrapped func(containers Containers), cont *cli.Context) {
	containers := c.GetContainers(cont)
	wrapped(containers)
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func NewCommander(app *cli.App) *Commander {
	cmd = &Commander{app: app, loader: ManifestLoader{}}

	cmd.NewLiftCommand()
	cmd.NewProvisionCommand()
	cmd.NewRunCommand()
	cmd.NewStartCommand()
	cmd.NewStopCommand()
	cmd.NewRemoveCommand()
	cmd.NewKillCommand()
	cmd.NewStatusCommand()

	return cmd
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (c *Commander) Register(cmd *cli.Command) {
	app.Commands = append(app.Commands, cmd)
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (c *Commander) Run(args []string) {
	app.Run(args)
}
