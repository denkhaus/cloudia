package engine

import (
	"container/list"
)

type Tree struct {
	unmet map[string]interface{}
	list.List
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) GetIndex(cont interface{}) int {
	nIndex := 0
	for e := t.Front(); e != nil; e = e.Next() {
		if e.Value == cont {
			return nIndex
		}
		nIndex++
	}

	return -1
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) GetContainerByName(name string) interface{} {
	for e := t.Front(); e != nil; e = e.Next() {
		cont := e.Value.(Container)
		if cont.Name() == name {
			return cont
		}
	}

	return nil
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) TreePushBack(cont Container) *list.Element {
	elm := t.PushBack(cont)
	t.RemoveUnmetRequirement(cont.Name())
	return elm
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) TreeInsertBefore(cont Container, elm *list.Element) *list.Element {
	newElm := t.InsertBefore(cont, elm)
	t.RemoveUnmetRequirement(cont.Name())
	return newElm
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) TreeInsertAfter(cont Container, elm *list.Element) *list.Element {
	newElm := t.InsertAfter(cont, elm)
	t.RemoveUnmetRequirement(cont.Name())
	return newElm
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) RemoveUnmetRequirement(name string) {
	if _, ok := t.unmet[name]; ok {
		delete(t.unmet, name)
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func (t *Tree) AddUnmetRequirement(name string) {
	if _, ok := t.unmet[name]; !ok {
		t.unmet[name] = name
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
//
///////////////////////////////////////////////////////////////////////////////////////////////
func NewTree() *Tree {
	tree := &Tree{}
	return tree
}
